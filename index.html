<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0c0e14">
<title>ParkPin</title>
<link rel="manifest" href="manifest.json">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:#0c0e14; --surface:#111520; --card:#161b28;
    --gold:#c9a84c; --gold-dim:#8a6c2a; --gold-pale:#c9a84c18;
    --text:#e8e4dc; --muted:#5a6070; --muted2:#3a4050;
    --green:#4a9e6a; --red:#c45a3a; --border:#1e2435; --border2:#252d42;
  }
  * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
  html, body { height:100%; height:100dvh; background:var(--bg); color:var(--text); font-family:'DM Sans',sans-serif; font-weight:300; overflow:hidden; }
  body { display:flex; flex-direction:column; position:relative; }

  /* Ambient glow */
  body::before {
    content:''; position:fixed; inset:0; pointer-events:none; z-index:0;
    background:
      radial-gradient(ellipse 60% 40% at 80% 10%, rgba(201,168,76,.06) 0%, transparent 60%),
      radial-gradient(ellipse 50% 60% at 10% 90%, rgba(74,94,130,.08) 0%, transparent 60%);
  }
  /* Grain */
  body::after {
    content:''; position:fixed; inset:0; pointer-events:none; z-index:0; opacity:.4;
    background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
  }
  .header, .main, .overlay, #closedScreen, .toast { position:relative; z-index:1; }

  /* â”€â”€ HEADER â”€â”€ */
  .header { padding:56px 28px 22px; display:flex; align-items:flex-end; justify-content:space-between; flex-shrink:0; border-bottom:1px solid var(--border); }
  .brand-label { font-size:9px; font-weight:400; letter-spacing:4px; color:var(--gold-dim); text-transform:uppercase; margin-bottom:3px; }
  .brand-title { font-family:'Cormorant Garamond',serif; font-size:30px; font-weight:300; letter-spacing:1px; color:var(--text); line-height:1; }
  .brand-title em { color:var(--gold); font-style:italic; }
  .close-btn { width:36px; height:36px; border-radius:50%; border:1px solid var(--border2); background:rgba(255,255,255,.03); display:flex; align-items:center; justify-content:center; cursor:pointer; transition:all .25s; color:var(--muted); font-size:13px; flex-shrink:0; margin-bottom:2px; }
  .close-btn:active { border-color:var(--red); color:var(--red); background:rgba(196,90,58,.1); }

  /* â”€â”€ MAIN â”€â”€ */
  .main { flex:1; display:flex; flex-direction:column; padding:0 28px; overflow:hidden; min-height:0; }

  /* â”€â”€ STATE A â”€â”€ */
  #stateEmpty { flex:1; display:flex; flex-direction:column; min-height:0; }
  .empty-hero { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding:20px 0 10px; min-height:0; }
  .empty-glyph { width:90px; height:90px; border-radius:50%; border:1px solid var(--border2); display:flex; align-items:center; justify-content:center; margin-bottom:22px; background:radial-gradient(circle, var(--card) 0%, var(--bg) 100%); font-size:32px; opacity:.5; position:relative; }
  .empty-glyph::before {
    content:''; position:absolute; inset:-1px; border-radius:50%;
    background:conic-gradient(from 180deg, var(--gold-dim) 0deg, transparent 80deg, transparent 280deg, var(--gold-dim) 360deg);
    opacity:.4;
    -webkit-mask:radial-gradient(farthest-side, transparent calc(100% - 1px), white calc(100% - 1px));
    mask:radial-gradient(farthest-side, transparent calc(100% - 1px), white calc(100% - 1px));
  }
  .empty-title { font-family:'Cormorant Garamond',serif; font-size:24px; font-weight:300; font-style:italic; color:var(--muted); margin-bottom:6px; letter-spacing:.5px; }
  .empty-sub { font-size:10px; color:var(--muted2); letter-spacing:3px; text-transform:uppercase; font-weight:400; }

  .park-form { background:linear-gradient(145deg, var(--card), var(--surface)); border-radius:20px; border:1px solid var(--border2); padding:22px; margin-bottom:24px; box-shadow:0 4px 40px rgba(0,0,0,.3); }
  .form-label { font-size:9px; letter-spacing:3.5px; color:var(--muted); text-transform:uppercase; font-weight:400; margin-bottom:12px; display:block; }
  .select-wrap { position:relative; margin-bottom:16px; }
  .level-select { width:100%; padding:16px 44px 16px 20px; background:var(--surface); border:1px solid var(--border2); border-radius:14px; font-family:'Cormorant Garamond',serif; font-size:40px; font-weight:300; color:var(--text); appearance:none; -webkit-appearance:none; cursor:pointer; outline:none; letter-spacing:1px; transition:border-color .3s, box-shadow .3s; line-height:1.2; }
  .level-select:focus { border-color:var(--gold-dim); box-shadow:0 0 0 3px rgba(201,168,76,.08); }
  .level-select option { font-size:20px; background:var(--surface); font-family:'DM Sans',sans-serif; }
  .select-chevron { position:absolute; right:16px; top:50%; transform:translateY(-50%); color:var(--gold-dim); font-size:16px; pointer-events:none; opacity:.8; }
  .divider-line { height:1px; background:var(--border); margin:0 0 16px; }
  .park-btn { width:100%; padding:17px; background:transparent; border:1px solid var(--gold-dim); border-radius:14px; font-family:'Cormorant Garamond',serif; font-size:20px; font-weight:400; font-style:italic; color:var(--gold); letter-spacing:1px; cursor:pointer; transition:all .25s; display:flex; align-items:center; justify-content:center; gap:10px; }
  .park-btn:not(:disabled):active { background:var(--gold-pale); transform:scale(.98); }
  .park-btn:disabled { opacity:.25; cursor:not-allowed; }
  .park-btn-dot { width:6px; height:6px; border-radius:50%; background:var(--gold); opacity:.7; }
  .park-btn:not(:disabled) .park-btn-dot { animation:pulse-dot 2s ease-in-out infinite; }
  @keyframes pulse-dot { 0%,100%{opacity:.7;transform:scale(1)} 50%{opacity:1;transform:scale(1.5)} }

  /* â”€â”€ STATE B â”€â”€ */
  #stateParked { flex:1; display:none; flex-direction:column; min-height:0; }
  .parked-hero { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding:12px 0; min-height:0; }

  .level-card { width:100%; background:linear-gradient(145deg,#15180e08,var(--card)); border:1px solid var(--gold-dim); border-radius:24px; padding:36px 20px 30px; position:relative; overflow:hidden; margin-bottom:18px; animation:card-glow 3s ease-in-out infinite; }
  @keyframes card-glow { 0%,100%{box-shadow:0 0 40px rgba(201,168,76,.08)} 50%{box-shadow:0 0 60px rgba(201,168,76,.16)} }
  .level-card::before { content:''; position:absolute; top:0; left:24px; right:24px; height:1px; background:linear-gradient(90deg,transparent,var(--gold),transparent); opacity:.6; }
  .level-card::after { content:''; position:absolute; inset:0; background:radial-gradient(ellipse 80% 50% at 50% 0%, rgba(201,168,76,.07) 0%, transparent 70%); pointer-events:none; }
  .level-card-label { font-size:9px; letter-spacing:4px; text-transform:uppercase; color:var(--muted); font-weight:400; margin-bottom:16px; position:relative; z-index:1; }
  .level-number { font-family:'Cormorant Garamond',serif; font-size:clamp(80px,22vw,110px); font-weight:300; line-height:1; color:var(--gold); letter-spacing:-2px; text-shadow:0 0 80px rgba(201,168,76,.25); position:relative; z-index:1; transition:all .4s cubic-bezier(.34,1.2,.64,1); }
  .level-saved-time { font-size:10px; letter-spacing:2px; color:var(--green); margin-top:14px; position:relative; z-index:1; display:flex; align-items:center; justify-content:center; gap:6px; }
  .level-saved-time::before { content:''; width:4px; height:4px; border-radius:50%; background:var(--green); flex-shrink:0; }

  .parked-tagline { font-family:'Cormorant Garamond',serif; font-size:13px; font-style:italic; color:var(--muted); letter-spacing:.5px; margin-bottom:22px; }
  .release-btn { width:100%; padding:19px; background:transparent; border:1px solid rgba(196,90,58,.5); border-radius:14px; font-family:'Cormorant Garamond',serif; font-size:20px; font-weight:400; font-style:italic; color:var(--red); letter-spacing:1px; cursor:pointer; transition:all .25s; display:flex; align-items:center; justify-content:center; gap:10px; margin-bottom:10px; }
  .release-btn:active { background:rgba(196,90,58,.08); transform:scale(.98); }
  .release-hint { font-size:9px; color:var(--muted2); text-align:center; letter-spacing:2.5px; text-transform:uppercase; margin-bottom:24px; }

  /* â”€â”€ OVERLAYS â”€â”€ */
  .overlay { position:fixed; inset:0; background:rgba(8,10,16,.8); backdrop-filter:blur(16px) saturate(120%); -webkit-backdrop-filter:blur(16px) saturate(120%); display:flex; align-items:center; justify-content:center; padding:32px; opacity:0; pointer-events:none; transition:opacity .3s; z-index:100; }
  .overlay.open { opacity:1; pointer-events:all; }
  .confirm-box { background:linear-gradient(145deg,var(--card),var(--surface)); border-radius:24px; padding:36px 28px; width:100%; max-width:340px; text-align:center; border:1px solid var(--border2); box-shadow:0 24px 80px rgba(0,0,0,.5); transform:translateY(24px) scale(.96); transition:transform .35s cubic-bezier(.34,1.2,.64,1); }
  .overlay.open .confirm-box { transform:translateY(0) scale(1); }
  .confirm-icon { font-size:44px; margin-bottom:16px; line-height:1; }
  .confirm-title { font-family:'Cormorant Garamond',serif; font-size:26px; font-weight:300; font-style:italic; margin-bottom:8px; color:var(--text); }
  .confirm-sub { font-size:11px; color:var(--muted); margin-bottom:28px; line-height:1.8; letter-spacing:.3px; }
  .confirm-btns { display:flex; gap:10px; }
  .btn-c { flex:1; padding:15px; border-radius:12px; font-family:'Cormorant Garamond',serif; font-size:17px; font-weight:400; font-style:italic; cursor:pointer; transition:all .2s; border:1px solid; letter-spacing:.5px; }
  .btn-c:active { transform:scale(.97); }
  .btn-c.yes { background:transparent; border-color:rgba(196,90,58,.5); color:var(--red); }
  .btn-c.yes:active { background:rgba(196,90,58,.08); }
  .btn-c.no  { background:transparent; border-color:var(--border2); color:var(--muted); }
  #overlayClose .btn-c.yes { border-color:var(--gold-dim); color:var(--gold); }
  #overlayClose .btn-c.yes:active { background:var(--gold-pale); }

  /* â”€â”€ CLOSED SCREEN â”€â”€ */
  #closedScreen { position:fixed; inset:0; background:var(--bg); display:none; flex-direction:column; align-items:center; justify-content:center; z-index:200; text-align:center; padding:40px; }
  .closed-glyph { width:72px; height:72px; border-radius:50%; border:1px solid var(--border2); display:flex; align-items:center; justify-content:center; margin-bottom:24px; font-family:'Cormorant Garamond',serif; font-size:28px; color:var(--gold-dim); }
  .closed-title { font-family:'Cormorant Garamond',serif; font-size:30px; font-weight:300; font-style:italic; color:var(--text); margin-bottom:10px; }
  .closed-sub { font-size:11px; color:var(--muted); line-height:1.9; margin-bottom:36px; letter-spacing:.3px; }
  .reopen-btn { padding:14px 36px; background:transparent; border:1px solid var(--gold-dim); border-radius:12px; font-family:'Cormorant Garamond',serif; font-size:16px; font-weight:400; font-style:italic; color:var(--gold); cursor:pointer; transition:all .25s; letter-spacing:.5px; }
  .reopen-btn:active { background:var(--gold-pale); transform:scale(.98); }

  /* â”€â”€ TOAST â”€â”€ */
  .toast { position:fixed; bottom:28px; left:28px; right:28px; background:linear-gradient(145deg,var(--card),var(--surface)); border:1px solid var(--border2); border-radius:14px; padding:16px 20px; font-size:11px; color:var(--text); text-align:center; letter-spacing:1px; text-transform:uppercase; opacity:0; transform:translateY(24px); transition:all .3s cubic-bezier(.34,1.2,.64,1); pointer-events:none; }
  .toast.show { opacity:1; transform:translateY(0); pointer-events:all; }
</style>
</head>
<body>

<div class="header">
  <div>
    <div class="brand-label">Parking</div>
    <div class="brand-title">Park<em>Pin</em></div>
  </div>
  <button class="close-btn" onclick="openOverlay('close')" title="Close app">âœ•</button>
</div>

<div class="main">

  <!-- STATE A: Empty -->
  <div id="stateEmpty">
    <div class="empty-hero">
      <div class="empty-glyph">ðŸ…¿</div>
      <div class="empty-title">Where'd you park?</div>
      <div class="empty-sub">Select a level below</div>
    </div>
    
    <div class="park-form">
      <label class="form-label">Parking Level</label>
      <div class="select-wrap">
        <select id="levelSelect" class="level-select" onchange="onSelectChange()">
          <option value="">Choose Level</option>
          <option value="B3">B3</option>
          <option value="B2">B2</option>
          <option value="B1">B1</option>
          <option value="G">G</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
          <option value="11">11</option>
          <option value="12">12</option>
        </select>
        <div class="select-chevron">â–¼</div>
      </div>
      <div class="divider-line"></div>
      <button id="parkBtn" class="park-btn" onclick="parkCar()" disabled>
        <span class="park-btn-dot"></span>
        Park Here
      </button>
    </div>
  </div>

  <!-- STATE B: Parked -->
  <div id="stateParked">
    <div class="parked-hero">
      <div class="level-card">
        <div class="level-card-label">Your Spot</div>
        <div class="level-number" id="levelNumber">â€”</div>
        <div class="level-saved-time" id="savedTime"></div>
      </div>
      <div class="parked-tagline">Safe & Secure</div>
    </div>
    <button class="release-btn" onclick="openOverlay('release')">Release Spot</button>
    <div class="release-hint">Forget where you parked?</div>
  </div>

</div>

<!-- OVERLAYS -->
<div class="overlay" id="overlayClose">
  <div class="confirm-box">
    <div class="confirm-icon">ðŸ‘‹</div>
    <div class="confirm-title">Close App?</div>
    <div class="confirm-sub" id="closeSubText">Press your phone's home button<br>or reopen from your home screen.</div>
    <div class="confirm-btns">
      <button class="btn-c yes" onclick="doClose()">Close</button>
      <button class="btn-c no"  onclick="closeOverlay('close')">Stay</button>
    </div>
  </div>
</div>

<div class="overlay" id="overlayRelease">
  <div class="confirm-box">
    <div class="confirm-icon">ðŸš—</div>
    <div class="confirm-title">Release Spot?</div>
    <div class="confirm-sub">This will clear your saved<br>parking level. Drive safe.</div>
    <div class="confirm-btns">
      <button class="btn-c yes" onclick="releaseSpot()">Release</button>
      <button class="btn-c no"  onclick="closeOverlay('release')">Cancel</button>
    </div>
  </div>
</div>

<div id="closedScreen">
  <div class="closed-glyph">âœ“</div>
  <div class="closed-title">App Closed</div>
  <div class="closed-sub" id="closedSubText">Press your phone's home button<br>or reopen from your home screen.</div>
  <button class="reopen-btn" onclick="reopenApp()">Reopen</button>
</div>

<div class="toast" id="toast"></div>

<script>
  const LEVEL_KEY = 'parkpin_level';
  const TIME_KEY  = 'parkpin_time';

  function init() {
    const saved = localStorage.getItem(LEVEL_KEY);
    const time  = localStorage.getItem(TIME_KEY);
    if (saved) showParked(saved, time); else showEmpty();
  }

  function showEmpty() {
    document.getElementById('stateEmpty').style.display  = 'flex';
    document.getElementById('stateParked').style.display = 'none';
    document.getElementById('levelSelect').value = '';
    document.getElementById('parkBtn').disabled  = true;
    document.getElementById('closeSubText').innerHTML = "Press your phone's home button<br>or reopen from your home screen.";
  }

  function showParked(level, time) {
    document.getElementById('stateEmpty').style.display  = 'none';
    document.getElementById('stateParked').style.display = 'flex';
    document.getElementById('levelNumber').textContent   = level;
    document.getElementById('savedTime').textContent     = time ? 'Saved at ' + time : '';
    document.getElementById('closeSubText').innerHTML    =
      'Level <strong style="color:var(--gold)">' + level + '</strong> is saved &mdash; see you back here.';
  }

  function onSelectChange() {
    document.getElementById('parkBtn').disabled = !document.getElementById('levelSelect').value;
  }

  function parkCar() {
    const lvl = document.getElementById('levelSelect').value;
    if (!lvl) return;
    if (navigator.vibrate) navigator.vibrate(30);
    const now = new Date().toLocaleTimeString('en-SG', { hour:'2-digit', minute:'2-digit' });
    localStorage.setItem(LEVEL_KEY, lvl);
    localStorage.setItem(TIME_KEY, now);
    showToast('Level ' + lvl + ' saved');
    setTimeout(() => showParked(lvl, now), 280);
  }

  function releaseSpot() {
    closeOverlay('release');
    if (navigator.vibrate) navigator.vibrate([20, 40, 20]);
    localStorage.removeItem(LEVEL_KEY);
    localStorage.removeItem(TIME_KEY);
    showToast('Spot released â€” drive safe');
    setTimeout(() => showEmpty(), 360);
  }

  function doClose() {
    closeOverlay('close');
    const saved = localStorage.getItem(LEVEL_KEY);
    document.getElementById('closedSubText').innerHTML = saved
      ? 'Level <strong style="color:var(--gold)">' + saved + '</strong> remains saved.<br>Reopen from your home screen anytime.'
      : "Press your phone's home button<br>or reopen from your home screen.";
    document.getElementById('closedScreen').style.display = 'flex';
    window.close();
  }

  function reopenApp() {
    document.getElementById('closedScreen').style.display = 'none';
  }

  function openOverlay(n) { document.getElementById('overlay' + n[0].toUpperCase() + n.slice(1)).classList.add('open'); }
  function closeOverlay(n) { document.getElementById('overlay' + n[0].toUpperCase() + n.slice(1)).classList.remove('open'); }

  function showToast(msg) {
    const t = document.getElementById('toast');
    t.textContent = msg; t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 2500);
  }

  init();
  if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js').catch(() => {});
</script>
</body>
</html>
