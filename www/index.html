<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#111111">
<title>ParkPin</title>
<link rel="manifest" href="manifest.json">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOKENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --bg:       #111111;
  --surface:  #191919;
  --card:     #1c1c1c;
  --lime:     #b8f000;
  --lime-dim: rgba(184,240,0,.18);
  --white:    #ffffff;
  --w60:      rgba(255,255,255,.6);
  --w40:      rgba(255,255,255,.4);
  --w28:      rgba(255,255,255,.28);
  --w15:      rgba(255,255,255,.15);
  --w08:      rgba(255,255,255,.08);
  --w05:      rgba(255,255,255,.05);
  --line:     rgba(255,255,255,.1);
  --red:      rgba(255,70,50,.85);
  --red-dim:  rgba(255,70,50,.18);
  --px: 18px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html, body {
  height:100%; height:100dvh;
  background:var(--bg); color:var(--white);
  font-family:'Space Grotesk', sans-serif;
  font-size:14px; overflow:hidden;
  -webkit-font-smoothing:antialiased;
}
body { display:flex; flex-direction:column; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WELCOME SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#screenWelcome {
  position:fixed; inset:0; z-index:600;
  background:var(--bg);
  display:flex; flex-direction:column;
  padding:max(72px, env(safe-area-inset-top)) var(--px) max(40px, env(safe-area-inset-bottom));
  transition:opacity .4s ease, transform .45s cubic-bezier(.4,0,.2,1);
}
#screenWelcome.out { opacity:0; transform:translateY(32px); pointer-events:none; }

.wlc-body { flex:1; display:flex; flex-direction:column; justify-content:center; }

.wlc-icon {
  width:54px; height:54px; border-radius:16px;
  background:var(--lime); display:flex; align-items:center;
  justify-content:center; font-size:26px; margin-bottom:40px;
}

.wlc-kicker {
  font-family:'Space Grotesk', sans-serif;
  font-size:10px; font-weight:700; letter-spacing:3.5px;
  text-transform:uppercase; color:var(--lime); margin-bottom:10px;
}
.wlc-heading {
  font-family:'Syne', sans-serif;
  font-size:36px; font-weight:800; line-height:1.1;
  letter-spacing:-.5px; color:var(--white); margin-bottom:14px;
}
.wlc-desc {
  font-size:14px; color:var(--w60); line-height:1.7; font-weight:400;
  max-width:290px;
}

.wlc-field { margin-top:48px; }
.wlc-label {
  font-size:9px; font-weight:700; letter-spacing:3px;
  text-transform:uppercase; color:var(--w40); margin-bottom:9px; display:block;
}
.wlc-input {
  width:100%; padding:15px var(--px);
  background:var(--card); border:1.5px solid var(--line);
  border-radius:16px; outline:none;
  font-family:'Syne', sans-serif;
  font-size:20px; font-weight:700; color:var(--white);
  transition:border-color .2s, box-shadow .2s;
  caret-color:var(--lime);
}
.wlc-input::placeholder { color:var(--w28); font-size:16px; font-weight:600; font-family:'Space Grotesk',sans-serif; }
.wlc-input:focus { border-color:rgba(184,240,0,.5); box-shadow:0 0 0 3px rgba(184,240,0,.1); }

.wlc-footer { flex-shrink:0; padding-top:24px; }
.wlc-btn {
  width:100%; padding:17px;
  background:var(--lime); border:none; border-radius:16px;
  font-family:'Syne', sans-serif;
  font-size:14px; font-weight:800; color:#0a1200;
  letter-spacing:.5px; cursor:pointer;
  transition:opacity .18s, transform .18s;
  box-shadow:0 6px 22px rgba(184,240,0,.22);
}
.wlc-btn:active { opacity:.84; transform:scale(.98); }
.wlc-btn:disabled { background:var(--card); color:var(--w28); box-shadow:none; cursor:not-allowed; }
.wlc-skip {
  text-align:center; margin-top:16px;
  font-size:12px; color:var(--w28); font-weight:500; cursor:pointer; letter-spacing:.3px;
}
.wlc-skip:active { color:var(--w60); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   APP HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.app-header {
  display:flex; align-items:center; justify-content:space-between;
  padding:max(52px, env(safe-area-inset-top)) var(--px) 14px;
  flex-shrink:0;
}
.user-row { display:flex; align-items:center; gap:11px; }
.avatar {
  width:42px; height:42px; border-radius:50%;
  background:linear-gradient(135deg,#e8a020,#b87010);
  display:flex; align-items:center; justify-content:center;
  font-family:'Syne',sans-serif; font-size:17px; font-weight:800;
  color:#fff; flex-shrink:0; letter-spacing:-.5px;
}
.welcome-label {
  font-size:9px; font-weight:600; letter-spacing:2.5px;
  text-transform:uppercase; color:var(--w40); margin-bottom:2px;
}
.user-name-text {
  font-family:'Syne', sans-serif;
  font-size:18px; font-weight:800; color:var(--white);
  letter-spacing:-.3px; line-height:1;
}
.gear-btn {
  width:40px; height:40px; border-radius:50%;
  border:1px solid var(--line); background:var(--w05);
  display:flex; align-items:center; justify-content:center;
  font-size:17px; color:var(--w40); cursor:pointer;
  transition:all .18s; flex-shrink:0;
}
.gear-btn:active { border-color:var(--lime); color:var(--lime); background:var(--lime-dim); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN WRAP (home â†” settings)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.screen-wrap { flex:1; display:flex; overflow:hidden; position:relative; min-height:0; }
.screen {
  min-width:100%; height:100%; display:flex; flex-direction:column;
  transition:transform .32s cubic-bezier(.4,0,.2,1); overflow:hidden;
}
#screenHome     { transform:translateX(0); }
#screenSettings {
  transform:translateX(100%);
  position:absolute; top:0; left:0; width:100%; height:100%;
  background:var(--bg);
}
body.settings-open #screenHome     { transform:translateX(-28%); pointer-events:none; }
body.settings-open #screenSettings { transform:translateX(0); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOME â€” PARKED STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#stateParked { flex:1; display:none; flex-direction:column; min-height:0; overflow:hidden; }

/* Hero card */
.hero-card {
  margin:0 var(--px); border-radius:26px; overflow:hidden;
  position:relative; flex-shrink:0;
  /* 16:9-ish tall card */
  padding-bottom:54%; height:0;
}
.hero-inner {
  position:absolute; inset:0;
  display:flex; flex-direction:column; justify-content:space-between;
  padding:18px 20px 20px;
}
.hero-bg {
  position:absolute; inset:0;
  background:linear-gradient(155deg, #141a13 0%, #0b1009 55%, #080d08 100%);
}
.hero-bg::before {
  content:''; position:absolute; inset:0;
  background:
    repeating-linear-gradient(0deg, transparent 0, transparent 44px, rgba(255,255,255,.012) 44px, rgba(255,255,255,.012) 45px),
    repeating-linear-gradient(90deg, transparent 0, transparent 66px, rgba(255,255,255,.008) 66px, rgba(255,255,255,.008) 67px);
}
.hero-bg::after {
  content:''; position:absolute; inset:0;
  background:
    radial-gradient(ellipse 70% 60% at 75% 15%, rgba(120,210,90,.13) 0%, transparent 65%),
    radial-gradient(ellipse 40% 30% at 20% 80%, rgba(80,120,200,.07) 0%, transparent 60%);
}
.hero-fade {
  position:absolute; inset:0;
  background:linear-gradient(to top, rgba(0,0,0,.9) 0%, rgba(0,0,0,.2) 55%, transparent 100%);
}
.h-top { display:flex; align-items:flex-start; justify-content:space-between; position:relative; z-index:2; }
.active-pill {
  background:var(--lime); color:#0a1200;
  font-family:'Space Grotesk',sans-serif;
  font-size:9px; font-weight:700; letter-spacing:3px; text-transform:uppercase;
  padding:6px 14px; border-radius:30px; line-height:1;
}
.level-circle {
  width:42px; height:42px; border-radius:50%;
  background:var(--w08); border:1.5px solid var(--w15);
  display:flex; align-items:center; justify-content:center;
  font-family:'Syne',sans-serif; font-size:13px; font-weight:800; color:var(--white);
}
.h-bottom { position:relative; z-index:2; }
.h-sublabel {
  font-size:10px; font-weight:600; letter-spacing:2px;
  text-transform:uppercase; color:var(--w40); margin-bottom:4px;
}
.h-level {
  font-family:'Syne',sans-serif; font-size:52px; font-weight:800;
  color:var(--white); line-height:1; letter-spacing:-2px; margin-bottom:8px;
}
.h-time { display:flex; align-items:center; gap:7px; font-size:12px; font-weight:600; color:var(--lime); }
.h-dot { width:6px; height:6px; border-radius:50%; background:var(--lime); box-shadow:0 0 8px var(--lime); flex-shrink:0; }

/* Action cards */
.actions { display:flex; gap:12px; margin:12px var(--px) 0; flex-shrink:0; }
.act-card {
  flex:1; border-radius:22px; padding:18px 16px;
  border:1px solid var(--w08); background:var(--surface);
  display:flex; flex-direction:column; gap:6px; cursor:pointer;
  transition:all .18s;
}
.act-card:active { transform:scale(.96); opacity:.85; }
.act-card.rel { border-color:var(--red-dim); }
.act-icon { font-size:22px; line-height:1; margin-bottom:2px; }
.act-title { font-family:'Syne',sans-serif; font-size:16px; font-weight:800; color:var(--white); }
.act-sub { font-size:10px; color:var(--w40); font-weight:500; letter-spacing:.3px; line-height:1.5; }

.home-spacer { flex:1; }
.home-indicator { flex-shrink:0; display:flex; justify-content:center; padding:10px 0 max(16px, env(safe-area-inset-bottom)); }
.home-bar { width:130px; height:5px; border-radius:3px; background:var(--w15); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOME â€” EMPTY STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#stateEmpty { flex:1; display:flex; flex-direction:column; overflow:hidden; min-height:0; }

.empty-slot {
  margin:0 var(--px); border-radius:26px;
  background:#181818; border:1.5px dashed var(--line);
  flex-shrink:0; position:relative;
  padding-bottom:54%; height:0;
}
.empty-inner {
  position:absolute; inset:0;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  gap:10px; text-align:center; padding:24px;
}
.empty-emoji { font-size:52px; opacity:.22; }
.empty-h { font-family:'Syne',sans-serif; font-size:19px; font-weight:800; color:var(--w28); }
.empty-s { font-size:10px; color:rgba(255,255,255,.18); letter-spacing:2.5px; text-transform:uppercase; font-weight:600; }

/* Level picker */
.picker-wrap { padding:14px var(--px) 0; flex-shrink:0; }
.picker-title { font-size:9px; font-weight:700; letter-spacing:3px; text-transform:uppercase; color:var(--w28); margin-bottom:11px; }
.lvl-grid { display:flex; flex-wrap:wrap; gap:9px; }
.lb {
  padding:10px 17px; border-radius:14px;
  border:1.5px solid var(--line); background:var(--w05);
  font-family:'Syne',sans-serif; font-size:18px; font-weight:700; color:var(--w60);
  cursor:pointer; transition:all .16s cubic-bezier(.34,1.2,.64,1); user-select:none;
}
.lb:active { transform:scale(.92); }
.lb.sel { background:var(--lime); border-color:var(--lime); color:#0a1200; box-shadow:0 4px 16px rgba(184,240,0,.3); transform:scale(1.04); }

/* CTA */
.cta-wrap { padding:12px var(--px) 0; flex-shrink:0; }
.cta-btn {
  width:100%; padding:17px;
  background:var(--lime); border:none; border-radius:18px;
  font-family:'Syne',sans-serif; font-size:14px; font-weight:800; color:#0a1200;
  letter-spacing:.5px; cursor:pointer; transition:opacity .18s, transform .18s;
  box-shadow:0 6px 22px rgba(184,240,0,.22);
}
.cta-btn:active { opacity:.84; transform:scale(.98); }
.cta-btn:disabled { background:var(--card); color:var(--w28); box-shadow:none; cursor:not-allowed; }

.cta-preview {
  text-align:center; font-size:10px; font-weight:600;
  letter-spacing:2px; text-transform:uppercase; color:var(--w40);
  margin-bottom:9px; min-height:14px;
}
.cta-preview span { color:var(--lime); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETTINGS SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.settings-inner { display:flex; flex-direction:column; height:100%; }

.back-header {
  display:flex; align-items:center; gap:12px;
  padding:max(52px, env(safe-area-inset-top)) var(--px) 16px;
  flex-shrink:0; border-bottom:1px solid var(--line);
}
.back-circle {
  width:38px; height:38px; border-radius:50%;
  background:var(--w05); border:1px solid var(--line);
  display:flex; align-items:center; justify-content:center;
  font-size:15px; color:var(--w60); cursor:pointer;
  transition:all .18s; flex-shrink:0;
}
.back-circle:active { background:var(--lime-dim); border-color:rgba(184,240,0,.3); color:var(--lime); }
.settings-page-title { font-family:'Syne',sans-serif; font-size:24px; font-weight:800; color:var(--white); }

.settings-fields {
  flex:1; overflow-y:auto; padding:22px var(--px);
  display:flex; flex-direction:column; gap:24px;
  -webkit-overflow-scrolling:touch;
}
.settings-fields::-webkit-scrollbar { display:none; }

.f-label {
  font-size:9px; font-weight:700; letter-spacing:3px;
  text-transform:uppercase; color:var(--w40); margin-bottom:9px; display:block;
}
.f-input {
  width:100%; padding:14px 16px;
  background:var(--card); border:1.5px solid var(--line);
  border-radius:16px; outline:none;
  font-family:'Syne',sans-serif; font-size:18px; font-weight:700;
  color:var(--white); caret-color:var(--lime);
  transition:border-color .2s, box-shadow .2s;
}
.f-input::placeholder { color:var(--w28); font-weight:600; font-size:15px; }
.f-input:focus { border-color:rgba(184,240,0,.4); box-shadow:0 0 0 3px rgba(184,240,0,.08); }

/* Tags box */
.tags-box {
  background:var(--card); border:1.5px solid var(--line);
  border-radius:16px; padding:12px; display:flex; flex-wrap:wrap;
  gap:8px; align-items:center; cursor:text; min-height:52px;
  transition:border-color .2s;
}
.tags-box:focus-within { border-color:rgba(184,240,0,.4); box-shadow:0 0 0 3px rgba(184,240,0,.08); }
.tag-pill {
  display:inline-flex; align-items:center; gap:6px;
  background:var(--w08); border-radius:9px; padding:7px 11px;
  font-family:'Syne',sans-serif; font-size:16px; font-weight:700; color:var(--white);
  animation:tag-pop .18s cubic-bezier(.34,1.4,.64,1);
}
@keyframes tag-pop { from{transform:scale(.7);opacity:0} to{transform:scale(1);opacity:1} }
.tag-x {
  font-size:9px; color:var(--w40); cursor:pointer; font-weight:800;
  width:14px; height:14px; border-radius:50%; background:var(--w15);
  display:flex; align-items:center; justify-content:center;
  transition:all .14s; flex-shrink:0;
}
.tag-x:active { background:var(--red); color:#fff; }
.tag-input {
  border:none; outline:none; background:transparent;
  font-family:'Syne',sans-serif; font-size:17px; font-weight:700;
  color:var(--white); min-width:70px; flex:1;
  text-transform:uppercase; caret-color:var(--lime);
}
.tag-input::placeholder { color:var(--w28); font-size:13px; font-weight:500; text-transform:none; font-family:'Space Grotesk',sans-serif; }
.f-hint { font-size:10px; color:var(--w28); margin-top:6px; letter-spacing:1px; font-weight:500; }

/* Quick chips */
.quick-row { display:flex; flex-wrap:wrap; gap:7px; }
.qc {
  padding:7px 13px; border-radius:10px;
  border:1px solid var(--line); background:var(--w05);
  font-family:'Syne',sans-serif; font-size:14px; font-weight:700; color:var(--w40);
  cursor:pointer; transition:all .15s;
}
.qc:active { border-color:rgba(184,240,0,.4); background:var(--lime-dim); color:var(--lime); transform:scale(.95); }
.qc.used { opacity:.25; pointer-events:none; }

.settings-cta {
  padding:12px var(--px) max(24px, env(safe-area-inset-bottom));
  border-top:1px solid var(--line); flex-shrink:0;
}
.settings-save-btn {
  width:100%; padding:17px;
  background:var(--lime); border:none; border-radius:18px;
  font-family:'Syne',sans-serif; font-size:14px; font-weight:800; color:#0a1200;
  letter-spacing:.5px; cursor:pointer; transition:opacity .18s, transform .18s;
  box-shadow:0 6px 22px rgba(184,240,0,.2);
}
.settings-save-btn:active { opacity:.84; transform:scale(.98); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   OVERLAYS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.overlay {
  position:fixed; inset:0;
  background:rgba(0,0,0,.65);
  backdrop-filter:blur(18px); -webkit-backdrop-filter:blur(18px);
  display:flex; align-items:center; justify-content:center; padding:28px;
  opacity:0; pointer-events:none; transition:opacity .22s; z-index:300;
}
.overlay.open { opacity:1; pointer-events:all; }
.confirm-box {
  background:#1e1e1e; border-radius:26px;
  padding:36px 24px 28px; width:100%; max-width:320px;
  text-align:center; border:1px solid var(--line);
  box-shadow:0 24px 64px rgba(0,0,0,.5);
  transform:translateY(20px) scale(.96);
  transition:transform .28s cubic-bezier(.34,1.2,.64,1);
}
.overlay.open .confirm-box { transform:translateY(0) scale(1); }
.confirm-icon { font-size:44px; margin-bottom:14px; line-height:1; }
.confirm-title {
  font-family:'Syne',sans-serif; font-size:22px; font-weight:800;
  letter-spacing:-.3px; margin-bottom:8px; color:var(--white);
}
.confirm-sub { font-size:13px; color:var(--w60); margin-bottom:24px; line-height:1.75; }
.confirm-btns { display:flex; gap:9px; }
.btn-c {
  flex:1; padding:15px; border-radius:14px;
  font-family:'Syne',sans-serif; font-size:13px; font-weight:800;
  cursor:pointer; transition:all .18s; border:1.5px solid;
  letter-spacing:.5px; text-transform:uppercase;
}
.btn-c:active { transform:scale(.97); }
.btn-c.yes { background:var(--red); border-color:var(--red); color:#fff; }
.btn-c.no  { background:transparent; border-color:var(--line); color:var(--w60); }
#overlayClose .btn-c.yes { background:var(--lime); border-color:var(--lime); color:#0a1200; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast {
  position:fixed; bottom:24px; left:18px; right:18px;
  background:#2a2a2a; border:1px solid var(--line); border-radius:14px;
  padding:13px 18px; font-size:11px; color:var(--white);
  text-align:center; letter-spacing:1.5px; text-transform:uppercase; font-weight:600;
  opacity:0; transform:translateY(14px);
  transition:all .28s cubic-bezier(.34,1.2,.64,1); pointer-events:none; z-index:500;
}
.toast.show { opacity:1; transform:translateY(0); }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     WELCOME SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screenWelcome">
  <div class="wlc-body">
    <div class="wlc-icon">ğŸ…¿</div>
    <div class="wlc-kicker">Welcome to</div>
    <div class="wlc-heading">ParkPin</div>
    <div class="wlc-desc">Never forget where you parked again. What should we call you?</div>

    <div class="wlc-field">
      <label class="wlc-label" for="wlcInput">Your Name</label>
      <input id="wlcInput" class="wlc-input" type="text"
        placeholder="e.g. Alex"
        autocomplete="given-name" autocorrect="off" spellcheck="false" maxlength="30"
        oninput="onWlcInput()" />
    </div>
  </div>

  <div class="wlc-footer">
    <button id="wlcBtn" class="wlc-btn" onclick="completeWelcome()" disabled>Get Started â†’</button>
    <div class="wlc-skip" onclick="skipWelcome()">Skip for now</div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     APP HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="app-header">
  <div class="user-row">
    <div class="avatar" id="headerAvatar">ğŸ…¿</div>
    <div>
      <div class="welcome-label" id="headerLabel">Parking</div>
      <div class="user-name-text" id="headerName">ParkPin</div>
    </div>
  </div>
  <div class="gear-btn" onclick="openSettings()">âš™</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen-wrap">

  <!-- HOME -->
  <div class="screen" id="screenHome">

    <!-- PARKED -->
    <div id="stateParked">
      <div class="hero-card">
        <div class="hero-bg"></div>
        <div class="hero-fade"></div>
        <div class="hero-inner">
          <div class="h-top">
            <div class="active-pill">â— Active</div>
            <div class="level-circle" id="heroCircle">â€”</div>
          </div>
          <div class="h-bottom">
            <div class="h-sublabel">Your Location</div>
            <div class="h-level" id="heroLevel">â€”</div>
            <div class="h-time"><div class="h-dot"></div><span id="heroTime"></span></div>
          </div>
        </div>
      </div>

      <div class="actions">
        <div class="act-card rel" onclick="openOverlay('release')">
          <div class="act-icon">ğŸ”“</div>
          <div class="act-title">Release</div>
          <div class="act-sub">Clear saved<br>parking spot</div>
        </div>
        <div class="act-card" onclick="openOverlay('close')">
          <div class="act-icon">ğŸšª</div>
          <div class="act-title">Exit App</div>
          <div class="act-sub">Close the app<br>completely</div>
        </div>
      </div>

      <div class="home-spacer"></div>
      <div class="home-indicator"><div class="home-bar"></div></div>
    </div>

    <!-- EMPTY -->
    <div id="stateEmpty">
      <div class="empty-slot">
        <div class="empty-inner">
          <div class="empty-emoji">ğŸš—</div>
          <div class="empty-h">Not parked yet</div>
          <div class="empty-s">Select your level below</div>
        </div>
      </div>

      <div class="picker-wrap">
        <div class="picker-title">Tap your parking level</div>
        <div class="lvl-grid" id="levelGrid"></div>
      </div>

      <div class="cta-wrap">
        <div class="cta-preview" id="ctaPreview">No level selected</div>
        <button class="cta-btn" id="ctaBtn" onclick="parkCar()" disabled>ğŸ“ Save This Spot</button>
      </div>

      <div class="home-spacer"></div>
      <div class="home-indicator"><div class="home-bar"></div></div>
    </div>

  </div><!-- /screenHome -->

  <!-- SETTINGS -->
  <div class="screen" id="screenSettings">
    <div class="settings-inner">

      <div class="back-header">
        <div class="back-circle" onclick="closeSettings()">â†</div>
        <div class="settings-page-title">Settings</div>
      </div>

      <div class="settings-fields">

        <div>
          <label class="f-label" for="settingsName">Your Name</label>
          <input id="settingsName" class="f-input" type="text"
            placeholder="Enter your name"
            autocomplete="given-name" autocorrect="off" spellcheck="false" maxlength="30" />
        </div>

        <div>
          <label class="f-label">My Carpark Levels</label>
          <div class="tags-box" id="tagsBox" onclick="focusTagInput()">
            <input type="text" id="tagInput" class="tag-input"
              placeholder="Type a levelâ€¦" maxlength="6"
              autocomplete="off" autocorrect="off"
              autocapitalize="characters" spellcheck="false" />
          </div>
          <div class="f-hint">Press Space or Enter after each level to add it</div>
        </div>

        <div>
          <label class="f-label">Quick Add</label>
          <div class="quick-row" id="quickRow">
            <div class="qc" onclick="quickAdd('B3')">B3</div>
            <div class="qc" onclick="quickAdd('B2')">B2</div>
            <div class="qc" onclick="quickAdd('B1')">B1</div>
            <div class="qc" onclick="quickAdd('G')">G</div>
            <div class="qc" onclick="quickAdd('1')">1</div>
            <div class="qc" onclick="quickAdd('2')">2</div>
            <div class="qc" onclick="quickAdd('3')">3</div>
            <div class="qc" onclick="quickAdd('4')">4</div>
            <div class="qc" onclick="quickAdd('5')">5</div>
            <div class="qc" onclick="quickAdd('1A')">1A</div>
            <div class="qc" onclick="quickAdd('1B')">1B</div>
            <div class="qc" onclick="quickAdd('2A')">2A</div>
            <div class="qc" onclick="quickAdd('2B')">2B</div>
            <div class="qc" onclick="quickAdd('3A')">3A</div>
            <div class="qc" onclick="quickAdd('3B')">3B</div>
          </div>
        </div>

      </div>

      <div class="settings-cta">
        <button class="settings-save-btn" onclick="saveSettings()">Save Changes</button>
      </div>

    </div>
  </div><!-- /screenSettings -->

</div><!-- /screen-wrap -->

<!-- OVERLAY: Close / Exit -->
<div class="overlay" id="overlayClose">
  <div class="confirm-box">
    <div class="confirm-icon">ğŸšª</div>
    <div class="confirm-title">Exit App?</div>
    <div class="confirm-sub">Your saved spot stays intact.<br>The app will close completely.</div>
    <div class="confirm-btns">
      <button class="btn-c yes" onclick="doClose()">Exit</button>
      <button class="btn-c no"  onclick="closeOverlay('close')">Stay</button>
    </div>
  </div>
</div>

<!-- OVERLAY: Release -->
<div class="overlay" id="overlayRelease">
  <div class="confirm-box">
    <div class="confirm-icon">ğŸ”“</div>
    <div class="confirm-title">Release Spot?</div>
    <div class="confirm-sub">This will clear your saved parking level. Drive safe.</div>
    <div class="confirm-btns">
      <button class="btn-c yes" onclick="releaseSpot()">Release</button>
      <button class="btn-c no"  onclick="closeOverlay('release')">Cancel</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* â”€â”€ Keys â”€â”€ */
const K_LEVEL    = 'parkpin_level';
const K_TIME     = 'parkpin_time';
const K_PRESETS  = 'parkpin_presets';
const K_NAME     = 'parkpin_name';
const K_ONBOARD  = 'parkpin_onboarded';
const DEFAULTS   = ['B3','B2','B1','G','1','2','3','4','5'];

let selLevel  = null;
let draftTags = [];

/* â•â•â•â•â•â•â•â• BOOT â•â•â•â•â•â•â•â• */
function init() {
  if (!localStorage.getItem(K_ONBOARD)) {
    document.getElementById('screenWelcome').style.display = 'flex';
  } else {
    document.getElementById('screenWelcome').style.display = 'none';
  }
  refreshHeader();
  const saved = localStorage.getItem(K_LEVEL);
  const time  = localStorage.getItem(K_TIME);
  if (saved) showParked(saved, time); else showEmpty();
}

/* â•â•â•â•â•â•â•â• WELCOME â•â•â•â•â•â•â•â• */
function onWlcInput() {
  document.getElementById('wlcBtn').disabled = !document.getElementById('wlcInput').value.trim();
}
function completeWelcome() {
  const name = document.getElementById('wlcInput').value.trim();
  if (!name) return;
  localStorage.setItem(K_NAME, name);
  localStorage.setItem(K_ONBOARD, '1');
  dismissWelcome();
}
function skipWelcome() {
  localStorage.setItem(K_ONBOARD, '1');
  dismissWelcome();
}
function dismissWelcome() {
  const el = document.getElementById('screenWelcome');
  el.classList.add('out');
  refreshHeader();
  setTimeout(() => el.style.display = 'none', 460);
}

/* â•â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â•â• */
function refreshHeader() {
  const name    = localStorage.getItem(K_NAME) || '';
  const avatarEl = document.getElementById('headerAvatar');
  const labelEl  = document.getElementById('headerLabel');
  const nameEl   = document.getElementById('headerName');

  if (name) {
    const h   = new Date().getHours();
    const tod = h < 12 ? 'Good morning' : h < 18 ? 'Good afternoon' : 'Good evening';
    avatarEl.textContent = name.charAt(0).toUpperCase();
    avatarEl.style.fontSize = '18px';
    labelEl.textContent  = tod;
    nameEl.textContent   = name;
  } else {
    avatarEl.textContent = 'ğŸ…¿';
    avatarEl.style.fontSize = '22px';
    labelEl.textContent  = 'Parking';
    nameEl.textContent   = 'ParkPin';
  }
}

/* â•â•â•â•â•â•â•â• PRESETS â•â•â•â•â•â•â•â• */
function getPresets() {
  try {
    const raw = localStorage.getItem(K_PRESETS);
    const arr = raw ? JSON.parse(raw) : null;
    return Array.isArray(arr) && arr.length ? arr : DEFAULTS;
  } catch(e) { return DEFAULTS; }
}

function renderGrid() {
  const presets = getPresets();
  const grid    = document.getElementById('levelGrid');
  grid.innerHTML = presets.map(lvl =>
    `<div class="lb${selLevel === lvl ? ' sel' : ''}" id="lb-${CSS.escape(lvl)}"
       onclick="selectLevel('${lvl.replace(/'/g,"\\'")}')">
      ${lvl}
    </div>`
  ).join('');
}

/* â•â•â•â•â•â•â•â• HOME â•â•â•â•â•â•â•â• */
function showEmpty() {
  document.getElementById('stateParked').style.display = 'none';
  document.getElementById('stateEmpty').style.display  = 'flex';
  selLevel = null;
  renderGrid();
  updateCtaPreview();
  document.getElementById('ctaBtn').disabled = true;
}

function showParked(level, time) {
  document.getElementById('stateEmpty').style.display  = 'none';
  document.getElementById('stateParked').style.display = 'flex';
  document.getElementById('heroLevel').textContent  = 'Level ' + level;
  document.getElementById('heroCircle').textContent = level;
  document.getElementById('heroTime').textContent   = time ? 'Saved at ' + time : '';
}

function selectLevel(lvl) {
  if (navigator.vibrate) navigator.vibrate(18);
  selLevel = lvl;
  document.querySelectorAll('.lb').forEach(el => el.classList.remove('sel'));
  const el = document.getElementById('lb-' + CSS.escape(lvl));
  if (el) el.classList.add('sel');
  document.getElementById('ctaBtn').disabled = false;
  updateCtaPreview();
}

function updateCtaPreview() {
  const el = document.getElementById('ctaPreview');
  el.innerHTML = selLevel
    ? 'Level <span>' + selLevel + '</span> selected'
    : 'No level selected';
}

function parkCar() {
  if (!selLevel) return;
  if (navigator.vibrate) navigator.vibrate(35);
  const now = new Date().toLocaleTimeString('en-SG', { hour:'2-digit', minute:'2-digit' });
  localStorage.setItem(K_LEVEL, selLevel);
  localStorage.setItem(K_TIME, now);
  showToast('Level ' + selLevel + ' saved âœ“');
  const lvl = selLevel;
  setTimeout(() => showParked(lvl, now), 300);
}

function releaseSpot() {
  closeOverlay('release');
  if (navigator.vibrate) navigator.vibrate([20,40,20]);
  localStorage.removeItem(K_LEVEL);
  localStorage.removeItem(K_TIME);
  showToast('Spot released â€” drive safe');
  setTimeout(() => showEmpty(), 350);
}

/* â•â•â•â•â•â•â•â• SETTINGS â•â•â•â•â•â•â•â• */
function openSettings() {
  draftTags = [...getPresets()];
  renderTags();
  updateQuickChips();
  document.getElementById('settingsName').value = localStorage.getItem(K_NAME) || '';
  document.body.classList.add('settings-open');
}

function closeSettings() {
  document.body.classList.remove('settings-open');
}

function renderTags() {
  const box   = document.getElementById('tagsBox');
  const input = document.getElementById('tagInput');
  box.querySelectorAll('.tag-pill').forEach(t => t.remove());
  draftTags.forEach(lvl => box.insertBefore(makeTag(lvl), input));
  input.value = '';
}

function makeTag(lvl) {
  const d = document.createElement('div');
  d.className = 'tag-pill'; d.dataset.val = lvl;
  d.innerHTML = `${lvl}<span class="tag-x" onclick="removeTag('${lvl.replace(/'/g,"\\'")}')">âœ•</span>`;
  return d;
}

function removeTag(lvl) {
  if (navigator.vibrate) navigator.vibrate(12);
  draftTags = draftTags.filter(t => t !== lvl);
  renderTags(); updateQuickChips();
}

function addTag(raw) {
  const val = raw.trim().toUpperCase().replace(/[^A-Z0-9]/g,'');
  if (!val) return;
  if (draftTags.includes(val)) { showToast(val + ' already added'); return; }
  if (draftTags.length >= 18) { showToast('Max 18 levels'); return; }
  if (navigator.vibrate) navigator.vibrate(15);
  draftTags.push(val);
  renderTags(); updateQuickChips();
}

function focusTagInput() { document.getElementById('tagInput').focus(); }

function updateQuickChips() {
  document.querySelectorAll('.qc').forEach(c => {
    c.classList.toggle('used', draftTags.includes(c.textContent.trim()));
  });
}

function quickAdd(val) { if (!draftTags.includes(val)) addTag(val); }

document.getElementById('tagInput').addEventListener('keydown', function(e) {
  if (['Enter',' ',','].includes(e.key)) {
    e.preventDefault();
    if (this.value.trim()) addTag(this.value.trim());
    this.value = '';
  } else if (e.key === 'Backspace' && !this.value && draftTags.length) {
    removeTag(draftTags[draftTags.length - 1]);
  }
});
document.getElementById('tagInput').addEventListener('input', function() {
  if (this.value.endsWith(' ') || this.value.endsWith(',')) {
    const c = this.value.slice(0,-1).trim();
    if (c) addTag(c);
    this.value = '';
  }
});

function saveSettings() {
  const pending = document.getElementById('tagInput').value.trim();
  if (pending) addTag(pending);
  if (!draftTags.length) { showToast('Add at least one level'); return; }

  const name = document.getElementById('settingsName').value.trim();
  if (name) localStorage.setItem(K_NAME, name);
  else localStorage.removeItem(K_NAME);

  localStorage.setItem(K_PRESETS, JSON.stringify(draftTags));
  if (navigator.vibrate) navigator.vibrate([15,30,15]);
  refreshHeader();
  closeSettings();
  if (document.getElementById('stateEmpty').style.display !== 'none') renderGrid();
  showToast('Settings saved âœ“');
}

/* â•â•â•â•â•â•â•â• EXIT APP â€” the fix â•â•â•â•â•â•â•â• */
function doClose() {
  closeOverlay('close');
  /* Small delay so overlay closes cleanly before exit */
  setTimeout(() => {
    try {
      /* Capacitor v3+ */
      if (window.Capacitor) {
        // import dynamically to avoid errors if plugin not loaded yet
        const { App } = Capacitor.Plugins;
        if (App && typeof App.exitApp === 'function') {
          App.exitApp(); return;
        }
      }
      /* Cordova */
      if (navigator.app && typeof navigator.app.exitApp === 'function') {
        navigator.app.exitApp(); return;
      }
      /* Fallback */
      window.close();
    } catch(err) {
      window.close();
    }
  }, 120);
}

/* â•â•â•â•â•â•â•â• UTILS â•â•â•â•â•â•â•â• */
function openOverlay(n)  { document.getElementById('overlay' + n[0].toUpperCase() + n.slice(1)).classList.add('open'); }
function closeOverlay(n) { document.getElementById('overlay' + n[0].toUpperCase() + n.slice(1)).classList.remove('open'); }

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

init();
if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js').catch(()=>{});
</script>
</body>
</html>
